<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>My Note | NoteTaker</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
/* Navbar */
.navbar {
  background-color: #198754;
  border-bottom: 2px solid #145c32;
}
.navbar-brand,
.navbar-nav .nav-link {
  color: white !important;
}
.navbar-nav .nav-link.active {
  font-weight: bold;
  text-decoration: underline;
  color: #d4f0d4 !important;
}
.navbar .btn-outline-success {
  border: 2px solid white;
  color: white;
  background-color: transparent;
}
.navbar .btn-outline-success:hover {
  background-color: white;
  color: #198754;
}

/* Cards & Notes */
.card-title {
  color: black;
  cursor: pointer;
}
.card {
  border: 2px solid green !important;
  box-shadow: none !important;
  background-color: #fff;
}
.card-text {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease, padding 0.3s ease;
  padding: 0 0;
}
.card-text.show {
  max-height: 200px;
  padding: 0.5rem 0;
}

/* Form styling */
#title, #desc {
  border: 2px solid green;
  border-radius: 5px;
  outline: none;
  transition: border-color 0.3s, box-shadow 0.3s;
}
#title:focus, #desc:focus {
  border-color: darkgreen;
  box-shadow: 0 0 5px rgba(0,128,0,0.5);
}
.green-outline-form {
  border: 2px solid green;
  border-radius: 0.5rem;
  background-color: #fff;
  padding: 1rem;
}
.green-btn {
  border: 2px solid green;
  color: green;
  background-color: white;
  border-radius: 0.25rem;
  padding: 0.5rem 1rem;
  cursor: pointer;
  transition: all 0.2s ease;
}
.green-btn:hover {
  background-color: green;
  color: white;
}

/* Footer & layout */
body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  margin: 0;
}
main {
  flex: 1;
}
footer {
  background-color: #198754;
  color: white;
  padding: 1.5rem 0;
}
footer a {
  color: white;
  text-decoration: none;
}
footer a:hover {
  color: #d4f0d4;
  text-decoration: underline;
}
</style>
</head>
<body>

<nav class="navbar navbar-expand-lg">
  <div class="container-fluid">
    <a class="navbar-brand mx-3" href="/">NoteTaker</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" 
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-center" id="navbarSupportedContent">
      <ul class="navbar-nav mx-auto d-flex flex-row">
        <li class="nav-item mx-2"><a class="nav-link" href="/">Home</a></li>
        <li class="nav-item mx-2"><a class="nav-link" href="/mynote">Mynote</a></li>
        <li class="nav-item mx-2"><a class="nav-link" href="/about">About</a></li>
      </ul>
      <div class="d-flex" id="authbutton"></div>
    </div>
  </div>
</nav>

<div class="container flex-grow-1">
  <h1 class="text-center">My Notes</h1>
  <div class="d-flex justify-content-center my-4">
    <form class="green-outline-form shadow rounded" style="width:500px; height:400px">
      <input type="text" id="title" class="form-control mb-2" placeholder="Title" style="height:50px">
      <div id="titleHelp" class="form-text text-center">Add an exciting TITLE!</div>
      <textarea id="desc" class="form-control mb-2" placeholder="Description" style="height:150px"></textarea>
      <div id="deschelp" class="form-text text-center">What's in your mind?</div>
      <div class="text-center mt-2">
        <button type="button" class="green-btn" id="addNoteBtn">Add Note</button>
      </div>
    </form>
  </div>
  <div id="notesContainer" class="row justify-content-center"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Navbar
function updateNav() {
  const user = JSON.parse(localStorage.getItem('user'));
  const authbutton = document.getElementById('authbutton');
  if (user) {
    authbutton.innerHTML = `<span class="me-2 text-white fw-semibold">Hi, ${user.username || user.email}</span>
                            <button class="btn btn-outline-danger mx-2" id="logoutbtn">Logout</button>`;
    document.getElementById('logoutbtn').addEventListener('click', () => {
      localStorage.removeItem('user');
      window.location.href = '/';
    });
  } else {
    authbutton.innerHTML = `<a href="/login"><button class="btn btn-outline-success mx-2">Login</button></a>
                            <a href="/signup"><button class="btn btn-outline-success mx-2">Signup</button></a>`;
  }
}
updateNav();

// Helper
async function postData(url, data) {
  const res = await fetch(url, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });
  return res.json();
}
function getCurrentUser() {
  const user = JSON.parse(localStorage.getItem('user'));
  return user && user.email ? user : null;
}

// Load notes
async function loadNotes() {
  const user = getCurrentUser();
  if (!user) return;
  const resp = await postData('/getnote', { email: user.email });
  if (resp.success) {
    const container = document.getElementById('notesContainer');
    container.innerHTML = '';
    resp.notes.forEach(note => {
      const div = document.createElement('div');
      div.className = 'col-12 col-sm-6 col-md-4 mb-3 d-flex justify-content-center';
      div.innerHTML = `
      <div class="card shadow rounded" style="width:400px;">
        <div class="card-body">
          <h5 class="card-title">${note.title}</h5>
          <p class="card-text">${note.description}</p>
        </div>
      </div>`;
      container.appendChild(div);

      const titleEl = div.querySelector('.card-title');
      const descEl = div.querySelector('.card-text');
      titleEl.addEventListener('click', () => {
        descEl.classList.toggle('show');
      });
    });
  }
}

// Add note
document.getElementById('addNoteBtn').addEventListener('click', async () => {
  const user = getCurrentUser();
  if (!user) {
    alert("Please login first to continue!");
    localStorage.setItem('redirectAfterLogin', window.location.pathname);
    localStorage.setItem('tempTitle', document.getElementById('title').value);
    localStorage.setItem('tempDesc', document.getElementById('desc').value);
    window.location.href = "/login";
    return;
  }
  const title = document.getElementById('title').value.trim();
  const desc = document.getElementById('desc').value.trim();
  if (!title || !desc) { alert("Fill both title and description!"); return; }

  const resp = await postData('/addnote', { email: user.email, title, description: desc });
  if (resp.success) {
    document.getElementById('title').value = '';
    document.getElementById('desc').value = '';
    loadNotes();
  } else {
    alert("Failed to add note: " + (resp.message || "Unknown error"));
  }
});

// Restore temp note after login
window.onload = () => {
  const user = getCurrentUser();
  if (!user) return;
  const tempTitle = localStorage.getItem('tempTitle') || '';
  const tempDesc = localStorage.getItem('tempDesc') || '';
  document.getElementById('title').value = tempTitle;
  document.getElementById('desc').value = tempDesc;
  localStorage.removeItem('tempTitle');
  localStorage.removeItem('tempDesc');
  loadNotes();
};
</script>

<footer class="bg-success text-white mt-5">
  <div class="container py-4">
    <div class="row">
      <div class="col-md-4 mb-3">
        <h5>About NoteTaker</h5>
        <p>Your personal note-taking companion. Organize, manage, and explore your notes effortlessly.</p>
      </div>
      <div class="col-md-4 mb-3">
        <h5>Quick Links</h5>
        <ul class="list-unstyled">
          <li><a href="/" class="text-white">Home</a></li>
          <li><a href="/mynote" class="text-white">My Notes</a></li>
          <li><a href="/about" class="text-white">About</a></li>
        </ul>
      </div>
      <div class="col-md-4 mb-3">
        <h5>Contact</h5>
        <a href="mailto:sadik38003@gmail.com" class="text-white">support@notetaker.com</a>
        <p>Phone: <a href="tel:+8801884286296" class="text-white">+880 1884 286296</a></p>     
      </div>
    </div>
    <div class="text-center mt-3">&copy; 2025 NoteTaker. All Rights Reserved.</div>
  </div>
</footer>

</body>
</html>
